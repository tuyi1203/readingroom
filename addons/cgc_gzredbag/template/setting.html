{template 'common/header'}
<script>
    require(['jquery', 'util'], function($, u) {
        $(function(){
            $('#theform').submit(function(){
                var message = '';
                if($.trim($(':text[name=appid]').val()) == '') {
                    message += '必须输入AppID<br>';
                }
                if($.trim($(':text[name=secret]').val()) == '') {
                    message += '必须输入AppSecret<br>';
                }
                if($.trim($(':text[name=mchid]').val()) == '') {
                    message += '必须输入微信支付商户号<br>';
                }
                if($.trim($(':text[name=password]').val()) == '') {
                    message += '必须输入微信支付商户密钥<br>';
                }
                if(message) {
                    u.message(message);
                    return false;
                }
                return true;
            });
        });
    });
</script>
<div class="clearfix">
    <form id="theform" class="form form-horizontal" action="" enctype ="multipart/form-data" method="post">
        <div class="panel panel-default">
            <div class="panel-heading">
                发红包接口参数
            </div>
            <div class="panel-body">
                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label"></label>
                    <div class="col-sm-9 col-xs-12">
                        <div class="alert alert-info">
                            发红包接口参数 <br>
                            <span class="label label-info">认证服务号并开通微信支付</span> <br>       
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">AppID</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="text" name="appid" value="{$settings['appid']}" class="form-control">
                        <span class="help-block">有微信支付权限的认证服务号AppID,就是本公众号的appid</span>
                       
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">AppSecret</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="text" name="secret" value="{$settings['secret']}" class="form-control">
                        <span class="help-block">认证服务号AppSecret, 就是本公众号的AppSecret</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">商户号</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="text" name="mchid" value="{$settings['mchid']}" class="form-control">
                        <span class="help-block">微信支付商户号, 开通微信支付才能获得商户号</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">商户支付密钥</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="text" name="password" value="{$settings['password']}" class="form-control">
                        <span class="help-block">微信支付商户所使用的支付密钥, 开通微信支付才能获得商户号</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">服务器IP</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="text" name="ip" value="{$settings['ip']}" class="form-control">
                        <span class="help-block">发放红包接口需要服务器IP. 程序将自动获取你的服务器IP, 如果获取失败, 请手动指定</span>
                    </div>
                </div>
                     <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">商户支付证书</label>
                    <div class="col-sm-9 col-xs-12">
                        <input name="apiclient_cert" type="hidden"  class="form-control" value="{$settings['apiclient_cert']}"/> 
                        <input name="apiclient_cert_file" type="file"  class="form-control" value=""/> 
                        <span class="help-block">
           {if !empty($settings['apiclient_cert'])} <label style="color:red">已保存成功</label>{/if}                 
                        从商户平台上下载支付证书, 解压并取得其中的 <mark>apiclient_cert.pem</mark>上传此文件</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">支付证书私钥</label>
                    <div class="col-sm-9 col-xs-12">
                        <input name="apiclient_key" type="hidden"  class="form-control" value="{$settings['apiclient_key']}"/> 
                        <input name="apiclient_key_file" type="file"   class="form-control" value=""/> 
                        <span class="help-block">
           {if !empty($settings['apiclient_key'])} <label style="color:red">已保存成功</label>{/if}                      
                        从商户平台上下载支付证书, 解压并取得其中的 <mark>apiclient_key.pem</mark>上传此文件</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">支付根证书</label>
                    <div class="col-sm-9 col-xs-12">
                        <input name="rootca" type="hidden"  class="form-control" value="{$settings['rootca']}"/> 
                        <input name="rootca_file" type="file"  class="form-control" value=""/> 
                        
                        <span class="help-block">
             {if !empty($settings['rootca'])} <label style="color:red">已保存成功</label>{/if}               
                        从商户平台上下载支付证书, 解压并取得其中的 <mark>rootca.pem</mark>上传此文件</span>
                    </div>
                </div>
                
                
                 </div>
                   </div>


                   
               <div class="panel panel-default">
                <div class="panel-heading">
                                                 红包选项
                 </div>
              <div class="panel-body">

                  <div class="form-group" style="display:none">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">限制地区</label>
                     <div class="col-sm-9 col-xs-12">
                        <input type="text" name="addr" value="{$settings['addr']}" class="form-control"/>
                        <span class="help-block">这个微信后台要开启获得用户地理信息,不填就没有限制，这个地区可以精确到区甚至是路
                         </span>
                    </div>
                </div>
                <div class="form-group" style="display:none">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">地区不符提示信息</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="text" name="addr_error" placeholder="" value="{$settings['addr_error']}" class="form-control">
                        <span class="help-block">如果不在这个地区提示用户一些信息。主要考虑到如果直接提示地区不对，用户可以利用软件改变自己的
                          地址，所以这里我们可以设置一些迷惑性的提示语，让用户不懂哪里出问题，就不会来刷红包。</span>
                    </div>
                </div>
              
    
                
                 <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">活动时间范围</label>
                    <div class="col-xs-12 col-sm-9">               	
                 		{php echo tpl_form_field_daterange('time', $settings['time'], true)}
                    </div>
                </div>
                
                
                                                       
                 <div class="form-group" style="display:">

                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">活动时间段</label>

                   <div class="col-sm-9 col-xs-12">
                        <div class="input-group">
                            <div class="input-group-addon">开始时间段</div>
                            <input type="text" class="form-control" placeholder="8" name="start_hour" value="{$settings['start_hour']}">
                            <div class="input-group-addon"></div>

                            <div class="input-group-addon">结束时间段</div>

                            <input type="text" class="form-control" placeholder="23" name="end_hour" value="{$settings['end_hour']}">

                            <div class="input-group-addon"></div>

                        </div>
                        
                       <div class="help-block">设置每天的什么时间段活动有效，其他时间无效</div>

                    </div>

                </div>

                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">线上线下选项</label>
                    <div class="col-xs-12 col-sm-9">
                        <label class="radio-inline"><input type="radio" name="offline" value="0"
                         {if empty($settings['offline'])} checked="checked" {/if}>线上领红包</label>
                        <label class="radio-inline"><input type="radio" name="offline" value="1" 
                         {if !empty($settings['offline'])}  checked="checked" {/if}>
                         线下领红包</label>
                          <span class="help-block">
                            线上领红包的话，就是发送关键字领红包，
                            线下领红包，可以在后台核销表那边导入核销代码，粉丝输入这个核销代码就可以领取红包。
                          </span>
                    </div>
                </div>
                


                <div class="form-group" style="display:">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">发红包类型接口</label>
                    <div class="col-xs-12 col-sm-9">
                        <label class="radio-inline"><input type="radio" onclick="sendtype(false)" name="sendtype"
                         value="0" id="hide"
                         {if empty($settings['sendtype'])} checked="checked" {/if}>企业付款(默认)</label>                       
                        <label class="radio-inline"><input type="radio"
                         name="sendtype" value="1"  onclick="sendtype(true)" id="show"
                         {if !empty($settings['sendtype'])}  checked="checked" {/if}>现金红包</label>
                          <span class="help-block">企业付款接口(24小时都可以发)
                                                                 现金红包接口(0点到8点不可以发)。
                          </span>
                    </div>
                </div>
                
            
                
                <div class="form-group sendtype" style="display:{if empty($settings['sendtype'])} none1 {/if}">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">红包活动名称</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="text" name="act_name" value="{$settings['act_name']}" class="form-control">
                        <span class="help-block">现金红包的活动名称,不要超过8个字</span>
                    </div>
                </div>
                
                   <div class="form-group sendtype" style="display:{if empty($settings['sendtype'])} none1 {/if}">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">红包发起人</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="text" name="send_name" value="{$settings['send_name']}" class="form-control">
                        <span class="help-block">发红包人的名称,不要超过8个字</span>
                    </div>
                  </div>
                
                  <div class="form-group sendtype" style="display:{if empty($settings['sendtype'])} none1 {/if}" >
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">红包备注</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="text" name="remark" value="{$settings['remark']}" class="form-control">
                        <span class="help-block">备注,不要超过8个字</span>
                    </div>
                </div>
                
              
               <div class="form-group">
                   <label class="col-xs-12 col-sm-3 col-md-2 control-label">红包总金额</label>
                    <div class="col-sm-9 col-xs-12">
                       <input type="text" name="total_money" value="{$settings['total_money']}" class="form-control">
                       <span class="help-block">发放的红包总金额,发完则提示没红包了(扫码支付获得的红包不统计)</span>
                    </div>
                </div>
              
                <div class="form-group" style="display:none">
                   <label class="col-xs-12 col-sm-3 col-md-2 control-label">获得红包的概率</label>
                    <div class="col-sm-9 col-xs-12">
                       <input type="text" name="probability" value="{$settings['probability']}" class="form-control">
                       <span class="help-block">获得红包的概率(设为100就是百分百获得红包)</span>
                    </div>
                </div>


                <div class="form-group">
                   <label class="col-xs-12 col-sm-3 col-md-2 control-label">获得红包最小金额</label>
                    <div class="col-sm-9 col-xs-12">
                     <input type="text" name="min_money" value="{$settings['min_money']}" class="form-control">
                     <span class="help-block">获得红包最大金额(最低一块钱)</span>
                    </div>
                </div>
                
                <div class="form-group">
                   <label class="col-xs-12 col-sm-3 col-md-2 control-label">获得红包最大金额</label>
                    <div class="col-sm-9 col-xs-12">
                     <input type="text" name="max_money" value="{$settings['max_money']}" class="form-control">
                     <span class="help-block">获得红包最大金额(最低一块钱)</span>
                    </div>
                </div>
                
                
              
         


             <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">获得红包以后的回复方式</label>
                    <div class="col-xs-12 col-sm-9">
                        <label class="radio-inline"><input type="radio" name="answer_type" value="0" id="text"
                         {if empty($settings['answer_type'])} checked="checked" {/if}>文本回复(默认)</label>
                        <label class="radio-inline"><input type="radio" name="answer_type" value="1"  id="thumb"
                         {if !empty($settings['answer_type'])}  checked="checked" {/if}>图文回复</label>
                    </div>
                </div>

                <div class="form-group answer_type" style="display:{if empty($settings['answer_type'])} none {/if}">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">标题：</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="text" name="title" value="{$settings['title']}" class="form-control">
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">描述：</label>
                    <div class="col-sm-9 col-xs-12">
                       <textarea style="min-height: 120px;" id="desc" name="desc"
                            class="form-control span7" cols="60">{$settings['desc']}</textarea>
                </div>
              </div>  

                 <div class="form-group answer_type" style="display:{if empty($settings['answer_type'])} none {/if}">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">图片：</label>
                    <div class="col-sm-9 col-xs-12">
                        {php echo tpl_form_field_image('thumb',$settings['thumb']);}
                    </div>
                </div>

                <div class="form-group answer_type" style="display:{if empty($settings['answer_type'])} none {/if}">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">链接：</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="text" name="url" value="{$settings['url']}" class="form-control">
                          <span class="help-block">http开头</span>
                    </div>
                </div>             
                 </div>
              
                </div>
                
                
                
         <div class="panel panel-default" >             
            <div class="panel panel-default">
                <div class="panel-heading">
                                                 活动未开始的图文回复
                 </div>
             
             
              <div class="panel-body">
       <div class="form-group" style="display:">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">标题：</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="text" name="wks_title" value="{$settings['wks_title']}" class="form-control">
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">描述：</label>
                    <div class="col-sm-9 col-xs-12">
                       <textarea style="min-height: 120px;" id="desc" name="wks_desc"
                            class="form-control span7" cols="60">{$settings['wks_desc']}</textarea>
                </div>
              </div>  

                 <div class="form-group" style="display:">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">图片：</label>
                    <div class="col-sm-9 col-xs-12">
                        {php echo tpl_form_field_image('wks_thumb',$settings['wks_thumb']);}
                    </div>
                </div>



                

                <div class="form-group" style="">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">链接：</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="text" name="wks_url" value="{$settings['wks_url']}" class="form-control">
                                <span class="help-block">http开头</span>
                    </div>
                </div>
                
                
                     <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label"></label>
                    <div class="col-md-2 col-lg-1">
                        <input name="submit" type="submit" value="保存" class="btn btn-primary btn-block" />
                        <input type="hidden" name="token" value="{$_W['token']}" />
                    </div>
                </div>
                

      </div>
              
                </div>

              
    </form>
</div>
<script>

 $("#hide").click(function(){
  $(".sendtype").hide();
  });
  $("#show").click(function(){
  $(".sendtype").show();
  });

  $("#text").click(function(){
  $(".answer_type").hide();
  });
  $("#thumb").click(function(){
  $(".answer_type").show();
  });


</script>
{template 'common/footer'}
